<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tic-Tac-Toe | –ö—Ä–µ—Å—Ç–∏–∫–∏-–Ω–æ–ª–∏–∫–∏</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é */
        .game-container {
            display: none;
        }
        
        .main-menu {
            display: flex;
            flex-direction: column;
            gap: 32px;
        }
        
        .menu-cards {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }
        
        @media (max-width: 480px) {
            .menu-cards {
                grid-template-columns: 1fr;
            }
        }
        
        .menu-card {
            background: var(--bg-card);
            border-radius: var(--border-radius);
            padding: 20px;
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }
        
        .menu-card:hover {
            transform: translateY(-4px);
            border-color: var(--primary-color);
            box-shadow: var(--shadow-lg);
        }
        
        .menu-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
        }
        
        .card-icon {
            font-size: 32px;
            color: var(--primary-color);
            margin-bottom: 12px;
        }
        
        .menu-card h3 {
            font-size: 18px;
            margin-bottom: 8px;
            color: var(--text-primary);
        }
        
        .menu-card p {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 12px;
        }
        
        .card-badge {
            display: inline-block;
            padding: 4px 12px;
            background: var(--primary-color);
            color: white;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .bottom-actions {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-top: auto;
        }
        
        @media (max-width: 480px) {
            .bottom-actions {
                grid-template-columns: 1fr;
            }
        }
        
        .game-title {
            text-align: center;
            font-size: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            color: var(--secondary-color);
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å—Ç–∞–≤–æ–∫ */
        .bet-options {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .balance-selector h3,
        .stake-amount h3 {
            margin-bottom: 12px;
            color: var(--text-secondary);
            font-size: 14px;
        }
        
        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .radio-label {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px;
            background: var(--bg-secondary);
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            transition: var(--transition);
        }
        
        .radio-label:hover {
            background: var(--primary-color);
        }
        
        .radio-label input {
            width: 18px;
            height: 18px;
        }
        
        .amount-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 16px;
        }
        
        .amount-btn {
            padding: 12px;
            background: var(--bg-secondary);
            border: none;
            border-radius: var(--border-radius-sm);
            color: var(--text-primary);
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
        }
        
        .amount-btn:hover {
            background: var(--primary-color);
        }
        
        .amount-btn.active {
            background: var(--primary-color);
            color: white;
        }
        
        .custom-amount input {
            width: 100%;
            padding: 12px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-sm);
            color: var(--text-primary);
            font-size: 16px;
        }
        
        .commission-notice {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px;
            background: rgba(255, 107, 53, 0.1);
            border: 1px solid var(--primary-color);
            border-radius: var(--border-radius-sm);
            color: var(--primary-color);
            font-size: 14px;
        }
        
        .modal-actions {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }
        
        .modal-actions button {
            flex: 1;
        }
        
        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –∫–æ–º–∏—Å—Å–∏–∏ */
        .notification {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--success-color);
            color: white;
            padding: 12px 24px;
            border-radius: var(--border-radius);
            display: none;
            align-items: center;
            gap: 8px;
            z-index: 1001;
            animation: slideUp 0.3s ease;
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }
    </style>
</head>
<body>
    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
    <div class="container">
        <!-- –®–∞–ø–∫–∞ —Å –±–∞–ª–∞–Ω—Å–∞–º–∏ -->
        <header class="header">
            <div class="user-info">
                <div class="avatar" id="userAvatar">
                    <i class="fas fa-user"></i>
                </div>
                <div class="user-details">
                    <span class="username" id="username">–ò–≥—Ä–æ–∫</span>
                    <div class="balances">
                        <div class="balance real-balance">
                            <i class="fas fa-coins"></i>
                            <span id="realBalance">0.00</span>
                        </div>
                        <div class="balance game-balance">
                            <i class="fas fa-gamepad"></i>
                            <span id="gameBalance">100</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="header-actions">
                <button class="btn-icon" id="profileBtn" title="–ü—Ä–æ—Ñ–∏–ª—å">
                    <i class="fas fa-user-circle"></i>
                </button>
                <button class="btn-icon" id="historyBtn" title="–ò—Å—Ç–æ—Ä–∏—è">
                    <i class="fas fa-history"></i>
                </button>
                <button class="btn-icon" id="adminBtn" title="–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å" style="display: none;">
                    <i class="fas fa-cog"></i>
                </button>
                <button class="btn-icon" id="partnerBtn" title="–ü–∞—Ä—Ç–Ω—ë—Ä-–ø–∞–Ω–µ–ª—å" style="display: none;">
                    <i class="fas fa-handshake"></i>
                </button>
                <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∞–¥–º–∏–Ω–∞ -->
                <button class="btn-icon" id="testAdminBtn" title="–¢–µ—Å—Ç –∞–¥–º–∏–Ω–∞" style="background: var(--primary-color); display: none;">
                    <i class="fas fa-user-shield"></i>
                </button>
            </div>
        </header>

        <!-- –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
        <main id="main-menu" class="main-menu">
            <h1 class="game-title">
                <i class="fas fa-times"></i>
                <span>–ö–†–ï–°–¢–ò–ö–ò-–ù–û–õ–ò–ö–ò</span>
                <i class="far fa-circle"></i>
            </h1>
            
            <div class="menu-cards">
                <!-- –ò–≥—Ä–∞ —Å –±–æ—Ç–æ–º -->
                <div class="menu-card" id="playWithBot">
                    <div class="card-icon">
                        <i class="fas fa-robot"></i>
                    </div>
                    <h3>–ò–≥—Ä–∞ —Å –±–æ—Ç–æ–º</h3>
                    <p>–°—ã–≥—Ä–∞–π—Ç–µ –ø—Ä–æ—Ç–∏–≤ –ò–ò-—Å–æ–ø–µ—Ä–Ω–∏–∫–∞</p>
                    <div class="card-badge">–ë–µ—Å–ø–ª–∞—Ç–Ω–æ</div>
                </div>
                
                <!-- –û–Ω–ª–∞–π–Ω –∏–≥—Ä–∞ -->
                <div class="menu-card" id="playOnline">
                    <div class="card-icon">
                        <i class="fas fa-globe"></i>
                    </div>
                    <h3>–û–Ω–ª–∞–π–Ω –∏–≥—Ä–∞</h3>
                    <p>–°—Ä–∞–∑–∏—Ç–µ—Å—å —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∏–≥—Ä–æ–∫–∞–º–∏</p>
                    <div class="card-badge">–°—Ç–∞–≤–∫–∏</div>
                </div>
                
                <!-- –°–æ–∑–¥–∞—Ç—å –ª–æ–±–±–∏ -->
                <div class="menu-card" id="createLobby">
                    <div class="card-icon">
                        <i class="fas fa-plus-circle"></i>
                    </div>
                    <h3>–°–æ–∑–¥–∞—Ç—å –ª–æ–±–±–∏</h3>
                    <p>–ü—Ä–∏–≥–ª–∞—Å–∏—Ç–µ –¥—Ä—É–≥–∞ –ø–æ–∏–≥—Ä–∞—Ç—å</p>
                    <div class="card-badge">–ü—Ä–∏–≤–∞—Ç–Ω–æ</div>
                </div>
                
                <!-- –ë—ã—Å—Ç—Ä–∞—è –∏–≥—Ä–∞ -->
                <div class="menu-card" id="quickPlay">
                    <div class="card-icon">
                        <i class="fas fa-bolt"></i>
                    </div>
                    <h3>–ë—ã—Å—Ç—Ä–∞—è –∏–≥—Ä–∞</h3>
                    <p>–ù–∞–π—Ç–∏ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞ –∑–∞ 30 —Å–µ–∫</p>
                    <div class="card-badge">–†–µ–π—Ç–∏–Ω–≥</div>
                </div>
            </div>
            
            <!-- –ù–∏–∂–Ω—è—è –ø–∞–Ω–µ–ª—å –¥–µ–π—Å—Ç–≤–∏–π -->
            <div class="bottom-actions">
                <button class="btn-primary" id="depositBtn">
                    <i class="fas fa-wallet"></i> –ü–æ–ø–æ–ª–Ω–∏—Ç—å
                </button>
                <button class="btn-secondary" id="withdrawBtn">
                    <i class="fas fa-money-bill-wave"></i> –í—ã–≤–µ—Å—Ç–∏
                </button>
                <button class="btn-outline" id="rulesBtn">
                    <i class="fas fa-book"></i> –ü—Ä–∞–≤–∏–ª–∞
                </button>
            </div>
        </main>

        <!-- –ò–≥—Ä–æ–≤–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (—Å–∫—Ä—ã—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –∏–≥—Ä—ã) -->
        <div id="game-container" class="game-container" style="display: none;">
            <!-- –ò–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–æ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
        <div class="modal" id="betModal">
            <div class="modal-content">
                <h2>–°–¥–µ–ª–∞–π—Ç–µ —Å—Ç–∞–≤–∫—É</h2>
                <div class="bet-options">
                    <div class="balance-selector">
                        <h3>–¢–∏–ø –±–∞–ª–∞–Ω—Å–∞:</h3>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" name="balanceType" value="game" checked>
                                <span>–ò–≥—Ä–æ–≤–æ–π –±–∞–ª–∞–Ω—Å</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="balanceType" value="real">
                                <span>–†–µ–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="stake-amount">
                        <h3>–°—É–º–º–∞ —Å—Ç–∞–≤–∫–∏:</h3>
                        <div class="amount-buttons">
                            <button class="amount-btn" data-amount="10">10</button>
                            <button class="amount-btn" data-amount="50">50</button>
                            <button class="amount-btn" data-amount="100">100</button>
                            <button class="amount-btn" data-amount="500">500</button>
                            <button class="amount-btn" data-amount="1000">1000</button>
                        </div>
                        <div class="custom-amount">
                            <input type="number" id="customAmount" placeholder="–î—Ä—É–≥–∞—è —Å—É–º–º–∞" min="1">
                        </div>
                    </div>
                    
                    <div class="commission-notice" id="commissionNotice" style="display: none;">
                        <i class="fas fa-info-circle"></i>
                        <span>–ü—Ä–∏ –≤—ã–∏–≥—Ä—ã—à–µ –±–æ—Ç —É–¥–µ—Ä–∂–∏—Ç 5% –∫–æ–º–∏—Å—Å–∏–∏</span>
                    </div>
                </div>
                <div class="modal-actions">
                    <button class="btn-secondary" id="cancelBet">–û—Ç–º–µ–Ω–∞</button>
                    <button class="btn-primary" id="confirmBet">–ò–≥—Ä–∞—Ç—å</button>
                </div>
            </div>
        </div>

        <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –∫–æ–º–∏—Å—Å–∏–∏ -->
        <div class="notification" id="commissionNotification" style="display: none;">
            <div class="notification-content">
                <i class="fas fa-percentage"></i>
                <span>–ë–æ—Ç —É–¥–µ—Ä–∂–∞–ª 5% –∫–æ–º–∏—Å—Å–∏–∏: <span id="commissionAmount">0</span></span>
            </div>
        </div>
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–æ–≤ -->
    <script src="config.js"></script>
    <script src="storage.js"></script>
    <script src="auth.js"></script>
    <script src="balance.js"></script>
    <script src="commission.js"></script>
    <script src="bets.js"></script>
    <script src="game.js"></script>
    <script src="bot.js"></script>
    <script src="notifications.js"></script>
    <script src="cryptobot.js"></script>
    <script src="payment.js"></script>
    <script src="main.js"></script>
    
    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let currentGameMode = null;
        let currentBet = {
            amount: 0,
            balanceType: 'game',
            gameMode: null,
            opponent: null
        };
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞
        function updateBalanceDisplay() {
            const user = getCurrentUser();
            if (!user) return;
            
            const realBalanceEl = document.getElementById('realBalance');
            const gameBalanceEl = document.getElementById('gameBalance');
            
            if (realBalanceEl) {
                realBalanceEl.textContent = (user.realBalance || 0).toFixed(2);
            }
            
            if (gameBalanceEl) {
                gameBalanceEl.textContent = (user.gameBalance || 0).toFixed(0);
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è UI –ø–æ —Ä–æ–ª—è–º
        function updateUIByRole() {
            const user = getCurrentUser();
            if (!user) return;
            
            const adminBtn = document.getElementById('adminBtn');
            const partnerBtn = document.getElementById('partnerBtn');
            const testAdminBtn = document.getElementById('testAdminBtn');
            
            if (adminBtn) {
                adminBtn.style.display = user.isAdmin ? 'block' : 'none';
            }
            
            if (partnerBtn) {
                partnerBtn.style.display = user.isPartner ? 'block' : 'none';
            }
            
            // –ö–Ω–æ–ø–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∞–¥–º–∏–Ω–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ
            if (testAdminBtn && !window.Telegram) {
                testAdminBtn.style.display = 'block';
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ä–µ–∂–∏–º–∞ –∏–≥—Ä—ã
        function setGameModeForBet(mode, opponent) {
            currentGameMode = mode;
            currentBet.gameMode = mode;
            currentBet.opponent = opponent;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å—Ç–∞–≤–æ–∫
            document.getElementById('betModal').style.display = 'flex';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –∫–æ–º–∏—Å—Å–∏–∏ –¥–ª—è –æ–Ω–ª–∞–π–Ω –∏–≥—Ä —Å —Ä–µ–∞–ª—å–Ω—ã–º –±–∞–ª–∞–Ω—Å–æ–º
            if (mode === 'online') {
                document.getElementById('commissionNotice').style.display = 'flex';
            } else {
                document.getElementById('commissionNotice').style.display = 'none';
            }
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        function showNotification(message, type = 'info') {
            if (window.showNotification) {
                window.showNotification(message, type);
            } else {
                // –ü—Ä–æ—Å—Ç–æ–π fallback
                alert(message);
            }
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
        function showMainMenu() {
            document.getElementById('game-container').style.display = 'none';
            document.getElementById('main-menu').style.display = 'flex';
            updateBalanceDisplay();
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –∏–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ
        function showGameContainer() {
            document.getElementById('main-menu').style.display = 'none';
            document.getElementById('game-container').style.display = 'block';
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...');
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
            initNavigation();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–µ–Ω—é –∫–∞—Ä—Ç–æ—á–µ–∫
            initMenuCards();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Å—Ç–∞–≤–æ–∫
            initBetModal();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
            showMainMenu();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º UI
            updateUIByRole();
            updateBalanceDisplay();
            
            // –¢–µ—Å—Ç–æ–≤–∞—è –∫–Ω–æ–ø–∫–∞ –∞–¥–º–∏–Ω–∞
            const testAdminBtn = document.getElementById('testAdminBtn');
            if (testAdminBtn) {
                testAdminBtn.addEventListener('click', function() {
                    createTestAdmin();
                });
            }
        });
        
        function initNavigation() {
            // –ö–Ω–æ–ø–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è
            document.getElementById('profileBtn').addEventListener('click', function() {
                window.location.href = 'profile.html';
            });
            
            // –ö–Ω–æ–ø–∫–∞ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
            document.getElementById('adminBtn').addEventListener('click', function() {
                window.location.href = 'admin.html';
            });
            
            // –ö–Ω–æ–ø–∫–∞ –ø–∞—Ä—Ç–Ω—ë—Ä-–ø–∞–Ω–µ–ª–∏
            document.getElementById('partnerBtn').addEventListener('click', function() {
                window.location.href = 'partner.html';
            });
            
            // –ö–Ω–æ–ø–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏
            document.getElementById('historyBtn').addEventListener('click', function() {
                showHistoryModal();
            });
            
            // –ö–Ω–æ–ø–∫–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è
            document.getElementById('depositBtn').addEventListener('click', function() {
                showDepositModal();
            });
            
            // –ö–Ω–æ–ø–∫–∞ –≤—ã–≤–æ–¥–∞
            document.getElementById('withdrawBtn').addEventListener('click', function() {
                if (window.showWithdrawModal) {
                    window.showWithdrawModal();
                } else {
                    showNotification('–°–∏—Å—Ç–µ–º–∞ –≤—ã–≤–æ–¥–æ–≤ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞', 'error');
                }
            });
            
            // –ö–Ω–æ–ø–∫–∞ –ø—Ä–∞–≤–∏–ª
            document.getElementById('rulesBtn').addEventListener('click', function() {
                showRulesModal();
            });
        }
        
        function initMenuCards() {
            // –ò–≥—Ä–∞ —Å –±–æ—Ç–æ–º
            document.getElementById('playWithBot').addEventListener('click', function() {
                setGameModeForBet('bot', '–ë–æ—Ç');
            });
            
            // –û–Ω–ª–∞–π–Ω –∏–≥—Ä–∞
            document.getElementById('playOnline').addEventListener('click', function() {
                setGameModeForBet('online', '–û–Ω–ª–∞–π–Ω —Å–æ–ø–µ—Ä–Ω–∏–∫');
            });
            
            // –°–æ–∑–¥–∞—Ç—å –ª–æ–±–±–∏
            document.getElementById('createLobby').addEventListener('click', function() {
                setGameModeForBet('private', '–î—Ä—É–≥');
            });
            
            // –ë—ã—Å—Ç—Ä–∞—è –∏–≥—Ä–∞
            document.getElementById('quickPlay').addEventListener('click', function() {
                setGameModeForBet('quick', '–°–ª—É—á–∞–π–Ω—ã–π —Å–æ–ø–µ—Ä–Ω–∏–∫');
            });
        }
        
        function initBetModal() {
            const betModal = document.getElementById('betModal');
            const cancelBtn = document.getElementById('cancelBet');
            const confirmBtn = document.getElementById('confirmBet');
            const balanceRadios = document.querySelectorAll('input[name="balanceType"]');
            const amountButtons = document.querySelectorAll('.amount-btn');
            const customAmountInput = document.getElementById('customAmount');
            
            // –û—Ç–º–µ–Ω–∞ —Å—Ç–∞–≤–∫–∏
            if (cancelBtn) {
                cancelBtn.addEventListener('click', function() {
                    betModal.style.display = 'none';
                    currentBet = { amount: 0, balanceType: 'game', gameMode: null, opponent: null };
                });
            }
            
            // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å—Ç–∞–≤–∫–∏
            if (confirmBtn) {
                confirmBtn.addEventListener('click', function() {
                    confirmBet();
                });
            }
            
            // –í—ã–±–æ—Ä —Ç–∏–ø–∞ –±–∞–ª–∞–Ω—Å–∞
            balanceRadios.forEach(radio => {
                radio.addEventListener('change', function(e) {
                    currentBet.balanceType = e.target.value;
                    updateCommissionNotice();
                });
            });
            
            // –í—ã–±–æ—Ä —Å—É–º–º—ã
            amountButtons.forEach(button => {
                button.addEventListener('click', function(e) {
                    // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
                    amountButtons.forEach(btn => btn.classList.remove('active'));
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å –Ω–∞–∂–∞—Ç–æ–π –∫–Ω–æ–ø–∫–µ
                    e.target.classList.add('active');
                    
                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—É–º–º—É
                    currentBet.amount = parseInt(e.target.dataset.amount);
                    customAmountInput.value = '';
                });
            });
            
            // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è —Å—É–º–º–∞
            if (customAmountInput) {
                customAmountInput.addEventListener('input', function(e) {
                    // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
                    amountButtons.forEach(btn => btn.classList.remove('active'));
                    
                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫—É—é —Å—É–º–º—É
                    const value = parseInt(e.target.value) || 0;
                    currentBet.amount = value;
                });
            }
        }
        
        function confirmBet() {
            const user = getCurrentUser();
            if (!user) {
                showNotification('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É', 'error');
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π —Å—É–º–º—ã
            if (currentBet.amount < 1) {
                showNotification('–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ —Å—Ç–∞–≤–∫–∏: 1', 'error');
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞
            if (currentBet.balanceType === 'game' && user.gameBalance < currentBet.amount) {
                showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∏–≥—Ä–æ–≤—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤', 'error');
                return;
            }
            
            if (currentBet.balanceType === 'real' && user.realBalance < currentBet.amount) {
                showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ä–µ–∞–ª—å–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤', 'error');
                return;
            }
            
            // –°–ø–∏—Å—ã–≤–∞–µ–º —Å—Ç–∞–≤–∫—É
            if (currentBet.balanceType === 'game') {
                user.gameBalance -= currentBet.amount;
            } else {
                user.realBalance -= currentBet.amount;
            }
            
            updateUser(user);
            updateBalanceDisplay();
            
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            document.getElementById('betModal').style.display = 'none';
            
            // –ù–∞—á–∏–Ω–∞–µ–º –∏–≥—Ä—É
            startGame(currentBet.gameMode, currentBet.opponent, currentBet.amount, currentBet.balanceType);
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ç–µ–∫—É—â—É—é —Å—Ç–∞–≤–∫—É
            currentBet = { amount: 0, balanceType: 'game', gameMode: null, opponent: null };
        }
        
        function updateCommissionNotice() {
            const notice = document.getElementById('commissionNotice');
            if (!notice) return;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –¥–ª—è –æ–Ω–ª–∞–π–Ω –∏–≥—Ä —Å —Ä–µ–∞–ª—å–Ω—ã–º –±–∞–ª–∞–Ω—Å–æ–º
            if (currentBet.gameMode === 'online' && currentBet.balanceType === 'real') {
                notice.style.display = 'flex';
            } else {
                notice.style.display = 'none';
            }
        }
        
        function startGame(mode, opponent, stake, balanceType) {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ
            showGameContainer();
            
            // –°–æ–∑–¥–∞–µ–º –∏–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏
            const gameContainer = document.getElementById('game-container');
            gameContainer.innerHTML = `
                <div class="game-header">
                    <button class="btn-icon" id="backToMenu">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <h2>–ò–≥—Ä–∞</h2>
                    <div class="game-timer" id="gameTimer">00:00</div>
                </div>
                
                <div class="game-info">
                    <div class="player-info" id="playerX">
                        <div class="player-avatar">
                            <i class="fas fa-times"></i>
                        </div>
                        <span class="player-name" id="playerXName">–í—ã (X)</span>
                        <span class="player-stake" id="playerXStake">–°—Ç–∞–≤–∫–∞: ${stake}</span>
                    </div>
                    
                    <div class="vs">VS</div>
                    
                    <div class="player-info" id="playerO">
                        <div class="player-avatar">
                            <i class="far fa-circle"></i>
                        </div>
                        <span class="player-name" id="playerOName">${opponent} (O)</span>
                        <span class="player-stake" id="playerOStake">–°—Ç–∞–≤–∫–∞: ${stake}</span>
                    </div>
                </div>
                
                <div class="game-board" id="gameBoard">
                    ${Array(9).fill('<div class="cell"></div>').join('')}
                </div>
                
                <div class="game-status" id="gameStatus">
                    <div class="current-player">
                        –°–µ–π—á–∞—Å —Ö–æ–¥–∏—Ç: <span id="currentPlayer">X</span>
                    </div>
                    <div class="game-result" id="gameResult"></div>
                </div>
                
                <div class="game-actions">
                    <button class="btn-secondary" id="restartGame">
                        <i class="fas fa-redo"></i> –ù–æ–≤–∞—è –∏–≥—Ä–∞
                    </button>
                    <button class="btn-primary" id="continueGame" style="display: none;">
                        <i class="fas fa-play"></i> –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å
                    </button>
                </div>
            `;
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∏–≥—Ä—É
            if (window.initGame) {
                window.initGame(mode, opponent, stake, balanceType);
            }
            
            // –ö–Ω–æ–ø–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ –≤ –º–µ–Ω—é
            document.getElementById('backToMenu').addEventListener('click', function() {
                showMainMenu();
            });
        }
        
        function showDepositModal() {
            if (window.showPaymentSelection) {
                window.showPaymentSelection('real');
            } else {
                showNotification('–°–∏—Å—Ç–µ–º–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞', 'error');
            }
        }
        
        function showHistoryModal() {
            const user = getCurrentUser();
            if (!user) {
                showNotification('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É', 'error');
                return;
            }
            
            const games = getUserGames(user.id);
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'flex';
            
            modal.innerHTML = `
                <div class="modal-content">
                    <h2>–ò—Å—Ç–æ—Ä–∏—è –∏–≥—Ä</h2>
                    <div style="max-height: 400px; overflow-y: auto; min-height: 200px;">
                        ${games.length === 0 ? 
                            '<p style="text-align: center; padding: 40px; color: var(--text-secondary);">–ù–µ—Ç —Å—ã–≥—Ä–∞–Ω–Ω—ã—Ö –∏–≥—Ä</p>' : 
                            games.slice().reverse().map(game => `
                                <div style="padding: 12px; border-bottom: 1px solid var(--border-color);">
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <div>
                                            <div style="font-weight: 600;">${getGameModeName(game.mode)}</div>
                                            <div style="font-size: 12px; color: var(--text-secondary);">
                                                ${new Date(game.timestamp).toLocaleDateString()} ${new Date(game.timestamp).toLocaleTimeString()}
                                            </div>
                                        </div>
                                        <div style="font-weight: 700; color: ${game.result === 'win' ? 'var(--success-color)' : game.result === 'lose' ? 'var(--danger-color)' : 'var(--warning-color)'}">
                                            ${game.result === 'win' ? '–ü–æ–±–µ–¥–∞' : game.result === 'lose' ? '–ü—Ä–æ–∏–≥—Ä—ã—à' : '–ù–∏—á—å—è'}
                                        </div>
                                    </div>
                                    <div style="font-size: 12px; color: var(--text-secondary); margin-top: 4px;">
                                        –°—Ç–∞–≤–∫–∞: ${game.stake} ‚Ä¢ ${game.balanceType === 'game' ? '–ò–≥—Ä–æ–≤—ã–µ' : '–†–µ–∞–ª—å–Ω—ã–µ'}
                                        ${game.commission ? ` ‚Ä¢ –ö–æ–º–∏—Å—Å–∏—è: ${game.commission}` : ''}
                                    </div>
                                </div>
                            `).join('')
                        }
                    </div>
                    <div class="modal-actions">
                        <button class="btn-primary" id="closeHistory">–ó–∞–∫—Ä—ã—Ç—å</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            modal.querySelector('#closeHistory').addEventListener('click', function() {
                modal.remove();
            });
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –Ω–∞ —Ñ–æ–Ω
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }
        
        function getGameModeName(mode) {
            const modes = {
                'bot': '–° –±–æ—Ç–æ–º',
                'online': '–û–Ω–ª–∞–π–Ω',
                'private': '–õ–æ–±–±–∏',
                'quick': '–ë—ã—Å—Ç—Ä–∞—è –∏–≥—Ä–∞'
            };
            return modes[mode] || mode;
        }
        
        function showRulesModal() {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'flex';
            
            modal.innerHTML = `
                <div class="modal-content">
                    <h2>–ü—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã</h2>
                    <div style="max-height: 400px; overflow-y: auto; padding-right: 10px;">
                        <h3>üéÆ –ö–∞–∫ –∏–≥—Ä–∞—Ç—å:</h3>
                        <p>1. –ò–≥—Ä–æ–∫–∏ –ø–æ –æ—á–µ—Ä–µ–¥–∏ —Å—Ç–∞–≤—è—Ç –∫—Ä–µ—Å—Ç–∏–∫–∏ (X) –∏ –Ω–æ–ª–∏–∫–∏ (O)<br>
                           2. –¶–µ–ª—å - –∑–∞–Ω—è—Ç—å 3 –∫–ª–µ—Ç–∫–∏ –ø–æ–¥—Ä—è–¥ –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏, –≤–µ—Ä—Ç–∏–∫–∞–ª–∏ –∏–ª–∏ –¥–∏–∞–≥–æ–Ω–∞–ª–∏<br>
                           3. –ü–µ—Ä–≤—ã–π —Ö–æ–¥ –¥–µ–ª–∞–µ—Ç –∏–≥—Ä–æ–∫ X</p>
                        
                        <h3>üí∞ –°—Ç–∞–≤–∫–∏ –∏ –±–∞–ª–∞–Ω—Å—ã:</h3>
                        <p>‚Ä¢ <strong>–ò–≥—Ä–æ–≤–æ–π –±–∞–ª–∞–Ω—Å</strong> - –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –º–æ–Ω–µ—Ç—ã –¥–ª—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏<br>
                           ‚Ä¢ <strong>–†–µ–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å</strong> - –Ω–∞—Å—Ç–æ—è—â–∏–µ –¥–µ–Ω—å–≥–∏ –¥–ª—è —Å–µ—Ä—å—ë–∑–Ω—ã—Ö –∏–≥—Ä<br>
                           ‚Ä¢ –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–∞–≤–∫–∞: 1 –º–æ–Ω–µ—Ç–∞/–µ–¥–∏–Ω–∏—Ü–∞<br>
                           ‚Ä¢ –ü—Ä–∏ –≤—ã–∏–≥—Ä—ã—à–µ: —Å—Ç–∞–≤–∫–∞ √ó 2<br>
                           ‚Ä¢ –ü—Ä–∏ –Ω–∏—á—å–µ: –≤–æ–∑–≤—Ä–∞—Ç —Å—Ç–∞–≤–∫–∏</p>
                        
                        <h3>‚ö° –ö–æ–º–∏—Å—Å–∏—è 5%:</h3>
                        <p>–ö–æ–º–∏—Å—Å–∏—è –≤–∑–∏–º–∞–µ—Ç—Å—è –¢–û–õ–¨–ö–û –ø—Ä–∏:<br>
                           ‚Ä¢ –ò–≥—Ä–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º –±–∞–ª–∞–Ω—Å–µ<br>
                           ‚Ä¢ –ü–æ–±–µ–¥–µ –≤ –æ–Ω–ª–∞–π–Ω-–∏–≥—Ä–µ (–Ω–µ –ø—Ä–æ—Ç–∏–≤ –±–æ—Ç–∞)<br>
                           ‚Ä¢ –†–∞–∑–º–µ—Ä: 5% –æ—Ç –¥–≤–æ–π–Ω–æ–π —Å—Ç–∞–≤–∫–∏</p>
                        
                        <h3>üëë –†–µ–∂–∏–º—ã –∏–≥—Ä—ã:</h3>
                        <p>‚Ä¢ <strong>–° –±–æ—Ç–æ–º</strong> - —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –±–µ–∑ –∫–æ–º–∏—Å—Å–∏–∏<br>
                           ‚Ä¢ <strong>–û–Ω–ª–∞–π–Ω</strong> - –∏–≥—Ä–∞ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞–º–∏<br>
                           ‚Ä¢ <strong>–õ–æ–±–±–∏</strong> - –ø—Ä–∏–≤–∞—Ç–Ω–∞—è –∏–≥—Ä–∞ —Å –¥—Ä—É–≥–æ–º<br>
                           ‚Ä¢ <strong>–ë—ã—Å—Ç—Ä–∞—è</strong> - —Å–ª—É—á–∞–π–Ω—ã–π —Å–æ–ø–µ—Ä–Ω–∏–∫ –∑–∞ 30 —Å–µ–∫</p>
                    </div>
                    <div class="modal-actions">
                        <button class="btn-primary" id="closeRules">–ü–æ–Ω—è—Ç–Ω–æ</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            modal.querySelector('#closeRules').addEventListener('click', function() {
                modal.remove();
            });
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –Ω–∞ —Ñ–æ–Ω
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }
        
        function createTestAdmin() {
            const adminUser = {
                id: 999,
                username: 'KovalchukAdmin',
                password: '99Adidas.Shewi12011979',
                isAdmin: true,
                isPartner: true,
                realBalance: 10000,
                gameBalance: 5000,
                totalWins: 0,
                totalGames: 0,
                createdAt: new Date().toISOString()
            };
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∞–¥–º–∏–Ω–∞
            const users = getUsers();
            const existingIndex = users.findIndex(u => u.username === 'KovalchukAdmin');
            
            if (existingIndex !== -1) {
                users[existingIndex] = adminUser;
            } else {
                users.push(adminUser);
            }
            
            localStorage.setItem('ticTacToeUsers', JSON.stringify(users));
            localStorage.setItem('currentUserId', '999');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º UI
            updateUIByRole();
            updateBalanceDisplay();
            
            showNotification('‚úÖ –¢–µ—Å—Ç–æ–≤—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å–æ–∑–¥–∞–Ω!', 'success');
        }
        
        // –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –¥—Ä—É–≥–∏—Ö —Ñ–∞–π–ª–∞—Ö
        window.showMainMenu = showMainMenu;
        window.showGameContainer = showGameContainer;
        window.setGameModeForBet = setGameModeForBet;
        window.updateBalanceDisplay = updateBalanceDisplay;
        window.updateUIByRole = updateUIByRole;
    </script>
</body>
</html>